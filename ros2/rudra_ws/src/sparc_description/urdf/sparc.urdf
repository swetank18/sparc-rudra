<?xml version="1.0"?>
<robot name="sparc_rover" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- Base link -->
  <link name="base_link">
    <inertial>
      <mass value="5.0"/>
      <inertia ixx="0.1" iyy="0.1" izz="0.1" ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual name="base_visual">
      <origin xyz="0 0 0.3"/>
      <geometry><box size="1 1 0.3"/></geometry>
      <material name="red"><color rgba="1 0 0 1"/></material>
    </visual>
    <collision name="base_collision">
      <geometry><box size="1 1 0.3"/></geometry>
    </collision>
  </link>

  <!-- LiDAR -->
  <link name="lidar_link">
    <inertial>
      <mass value="0.1"/>
      <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual name="lidar_visual">
      <origin xyz="0 0 0.5"/>
      <geometry><cylinder radius="0.05" length="0.05"/></geometry>
      <material name="green"><color rgba="0 1 0 1"/></material>
    </visual>
  </link>

  <joint name="lidar_joint" type="fixed">
    <parent link="base_link"/>
    <child link="lidar_link"/>
    <origin xyz="0 0 0.3"/>
  </joint>

  <!-- Wheels -->
  <!-- Front-Left -->
  <link name="wheel_fl">
    <inertial><mass value="0.2"/><inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0" ixz="0" iyz="0"/></inertial>
    <visual name="wheel_fl_visual">
      <origin xyz="0.4 0.35 0" rpy="0 1.57 0"/>
      <geometry><cylinder radius="0.1" length="0.05"/></geometry>
      <material name="black"><color rgba="0 0 0 1"/></material>
    </visual>
    <collision name="wheel_fl_collision">
      <origin xyz="0.4 0.35 0" rpy="0 1.57 0"/>
      <geometry><cylinder radius="0.1" length="0.05"/></geometry>
    </collision>
  </link>
  <joint name="joint_wheel_fl" type="continuous">
    <parent link="base_link"/>
    <child link="wheel_fl"/>
    <origin xyz="0.4 0.35 0"/>
    <axis xyz="0 1 0"/>
  </joint>

  <!-- Front-Right -->
  <link name="wheel_fr">
    <inertial><mass value="0.2"/><inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0" ixz="0" iyz="0"/></inertial>
    <visual name="wheel_fr_visual">
      <origin xyz="0.4 -0.35 0" rpy="0 1.57 0"/>
      <geometry><cylinder radius="0.1" length="0.05"/></geometry>
      <material name="black"><color rgba="0 0 0 1"/></material>
    </visual>
    <collision name="wheel_fr_collision">
      <origin xyz="0.4 -0.35 0" rpy="0 1.57 0"/>
      <geometry><cylinder radius="0.1" length="0.05"/></geometry>
    </collision>
  </link>
  <joint name="joint_wheel_fr" type="continuous">
    <parent link="base_link"/>
    <child link="wheel_fr"/>
    <origin xyz="0.4 -0.35 0"/>
    <axis xyz="0 1 0"/>
  </joint>

  <!-- Rear-Left -->
  <link name="wheel_rl">
    <inertial><mass value="0.2"/><inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0" ixz="0" iyz="0"/></inertial>
    <visual name="wheel_rl_visual">
      <origin xyz="-0.4 0.35 0" rpy="0 1.57 0"/>
      <geometry><cylinder radius="0.1" length="0.05"/></geometry>
      <material name="black"><color rgba="0 0 0 1"/></material>
    </visual>
    <collision name="wheel_rl_collision">
      <origin xyz="-0.4 0.35 0" rpy="0 1.57 0"/>
      <geometry><cylinder radius="0.1" length="0.05"/></geometry>
    </collision>
  </link>
  <joint name="joint_wheel_rl" type="continuous">
    <parent link="base_link"/>
    <child link="wheel_rl"/>
    <origin xyz="-0.4 0.35 0"/>
    <axis xyz="0 1 0"/>
  </joint>

  <!-- Rear-Right -->
  <link name="wheel_rr">
    <inertial><mass value="0.2"/><inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0" ixz="0" iyz="0"/></inertial>
    <visual name="wheel_rr_visual">
      <origin xyz="-0.4 -0.35 0" rpy="0 1.57 0"/>
      <geometry><cylinder radius="0.1" length="0.05"/></geometry>
      <material name="black"><color rgba="0 0 0 1"/></material>
    </visual>
    <collision name="wheel_rr_collision">
      <origin xyz="-0.4 -0.35 0" rpy="0 1.57 0"/>
      <geometry><cylinder radius="0.1" length="0.05"/></geometry>
    </collision>
  </link>
  <joint name="joint_wheel_rr" type="continuous">
    <parent link="base_link"/>
    <child link="wheel_rr"/>
    <origin xyz="-0.4 -0.35 0"/>
    <axis xyz="0 1 0"/>
  </joint>

  <!-- LiDAR sensor simulation -->
  <gazebo reference="lidar_link">
    <sensor type="gpu_ray" name="lidar">
      <update_rate>10.0</update_rate>
      <visualize>true</visualize>
      <ray>
        <scan>
          <horizontal>
            <samples>720</samples>
            <resolution>1</resolution>
            <min_angle>-3.14</min_angle>
            <max_angle>3.14</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>0.12</min>
          <max>12.0</max>
          <resolution>0.01</resolution>
        </range>
      </ray>
      <plugin name="gazebo_ros_laser" filename="libgazebo_ros_ray_sensor.so">
        <ros>
          <namespace>/sparc_rover</namespace>
          <remapping>scan:=/scan</remapping>
        </ros>
      </plugin>
    </sensor>
  </gazebo>

    <!-- ROS 2 Control plugin (Jazzy + Gazebo Harmonic) -->
  <gazebo>
    <plugin name="ros2_control_plugin" filename="libgz_ros2_control-system.so">
      <ros>
        <namespace>/sparc_rover</namespace>
      </ros>
      <parameters>config/ros2_control.yaml</parameters>
    </plugin>
  </gazebo>

</robot>

